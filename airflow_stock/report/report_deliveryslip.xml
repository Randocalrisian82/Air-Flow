<?xml version="1.0" encoding="UTF-8" ?>
<odoo>

    <template id="report_delivery_document_inherit_airflow" inherit_id="stock.report_delivery_document">
        <!-- Report-specific styles -->
        <xpath expr="//t[@t-set='o']" position="before">
            <style>
                .origin {
                    font-size: initial;
                    vertical-align: middle;
                    padding-bottom: 4px;
                }
            </style>
        </xpath>
        <!-- Add row for Shipping Method and Sales Rep and Project Name -->
        <xpath expr="//div[@name='customer_address']" position="before">
            <div class="row mt16 mb16">
                <div class="col-xs-4">
                    <span>Shipping Method:</span>
                    <span t-field="o.ship_method"/>
                </div>
                <div class="col-xs-4 pull-right">
                    <div>
                        <span>Sales Rep:</span>
                        <span t-field="o.sales_rep"/>
                    </div>
                    <div>
                        <span>Email:</span>
                        <span t-esc="o.sales_rep.email" t-options='{"widget": "email"}'/>
                    </div>
                    <div>
                        <span>Phone:</span>
                        <span t-esc="o.sales_rep.phone" t-options='{"widget": "phone"}'/>
                    </div>
                    <div class="mt16">
                        <span>Project Name:</span>
                        <span t-field="o.proj_name" />
                    </div>
                </div>
            </div>
        </xpath>
        <!-- Replace address row with Ship To address and Customer Address -->
        <xpath expr="//div[@name='customer_address']" position="replace">
            <t t-set="partner" t-value="o.partner_id or (o.move_lines and o.move_lines[0].partner_id) or False"/>
            <t t-set="parent" t-value="(partner and partner.parent_id) or partner or False"/>
            <div class="row" name="customer_address">
                <div class="col-xs-4">
                    <div>
                        <span>
                            <strong>Ship To Address:</strong>
                        </span>
                    </div>
                    <div t-if="partner" name="ship_to_address">
                        <div t-esc="partner" t-options='{"widget": "contact", "fields": ["address", "name", "phone"], "no_marker": True}'/>
                    </div>
                </div>
                <div class="col-xs-4 pull-right">
                    <div>
                        <span>
                            <strong>Customer Address:</strong>
                        </span>
                    </div>
                    <div t-if="parent" name="customer_address">
                        <div t-esc="parent" t-options='{"widget": "contact", "fields": ["address", "name", "phone"], "no_marker": True}'/>
                    </div>
                </div>
            </div>
        </xpath>
        <!-- Add origin after name -->
        <xpath expr="//div[hasclass('page')]//span[@t-field='o.name']" position="after">
            <span class="origin" t-if="o.origin" t-field="o.origin"/>
        </xpath>
        <!-- Replace origin column in table with SO number (called Airflow Order #) -->
        <xpath expr="//table//thead//th[@t-if='o.origin']" position="replace">
            <th t-if="o.sale_id.name">
                <strong>Airflow Order #</strong>
            </th>
        </xpath>
        <xpath expr="//table//tbody//td[@t-if='o.origin']" position="replace">
            <td t-if="o.sale_id.name">
                <span t-esc="o.sale_id.name.replace('SO', '')"/>
            </td>
        </xpath>
        <!-- Remove time from date -->
        <xpath expr="//td[@name='td_sched_date']//span[@t-field='o.date_done']" position="attributes">
            <attribute name="t-options">{"widget": "date"}</attribute>
        </xpath>
        <xpath expr="//td[@name='td_sched_date']//span[@t-field='o.scheduled_date']" position="attributes">
            <attribute name="t-options">{"widget": "date"}</attribute>
        </xpath>
        <!-- Add Cust Job # and Cust PO # to table -->
        <xpath expr="//th[@name='td_sched_date_h']" position="after">
            <th t-if="o.job_code">
                <strong>Cust Job #</strong>
            </th>
            <th t-if="o.cust_po">
                <strong>Cust PO #</strong>
            </th>
        </xpath>
        <xpath expr="//td[@name='td_sched_date']" position="after">
            <td t-if="o.job_code">
                <span t-esc="o.job_code"/>
            </td>
            <td t-if="o.cust_po">
                <span t-esc="o.cust_po"/>
            </td>
        </xpath>
        <!-- Overhaul the move lines tables -->
        <xpath expr="//tr[@t-as='move']/ancestor::table" position="replace">
            <table class="table table-condensed mt48" t-if="o.state!='done'">
                <thead>
                    <tr>
                        <th>
                            <strong>Qty</strong>
                        </th>
                        <th>
                            <strong>Model</strong>
                        </th>
                        <th>
                            <strong>Item #</strong>
                        </th>
                        <th>
                            <strong>Product Description</strong>
                        </th>
                        <th>
                            <strong>Manufacturer</strong>
                        </th>
                        <th>
                            <strong>Tag</strong>
                        </th>
                    </tr>
                </thead>
                <tbody>
                    <t t-set="lines" t-value="o.move_lines.filtered(lambda x: x.product_uom_qty)"/>
                    <tr t-foreach="lines" t-as="move">
                        <td>
                            <span t-field="move.product_uom_qty"/>
                            <span t-field="move.product_uom"/>
                        </td>
                        <td>
                            <span t-field="move.product_model"/>
                        </td>
                        <td>
                            <span t-field="move.product_id"/>
                            <p t-if="o.picking_type_code == 'outgoing'">
                                <span t-field="move.product_id.sudo().description_pickingout"/>
                            </p>
                            <p t-if="o.picking_type_code == 'incoming'">
                                <span t-field="move.product_id.sudo().description_pickingin"/>
                            </p>
                        </td>
                        <td>
                            <span t-field="move.product_description"/>
                        </td>
                        <td>
                            <span t-field="move.manufacturer"/>
                        </td>
                        <td></td>
                    </tr>
                </tbody>
            </table>
        </xpath>
    </template>

    <!-- Remove Customer Reference section in header (as it's displayed in the table above) -->
    <template id="report_delivery_document_sale_stock_inherit_airflow" inherit_id="sale_stock.report_delivery_document_inherit_sale_stock">
        <xpath expr="//div[hasclass('row')][@t-if='o.sudo().sale_id.client_order_ref']" position="replace"></xpath>
    </template>

</odoo>
